<template>
  <div class="box-border h-83vh w-full flex flex-col gap-10">
    <div class="bg-[#fff]/[0.4] p-y-5px p-l-0.5em">
      <span>å–·å¢¨æ‰“å°ä½ç½®è°ƒæ•´</span>
    </div>
    <div class="box-border flex flex-col">
      <div v-show="showKeyboard">
        <SimpleKeyboard
          ref="simpleKeyboard"
          :input="cursorPosition?.target.value"
          keyboard-width="w32%"
          :layout="layout"
          :max-length="layout === 'num' ? 5 : 6"
          @on-change="onChangeKeyboard"
          @closekeyboard="closekeyboard"
        />
      </div>
      <section class="position-box w-full flex">
        <div class="w50% flex flex-col flex-1 pl-20">
          <div>ä¸»å‰¯é¡µï¼ˆå¹³å°1ï¼‰</div>
          <table>
            <tbody>
              <tr>
                <td class="text-right">
                  Xè½´ï¼š
                </td>
                <td>
                  <a-input
                    v-model:value="PostionData.uvMainPlatform0.x"
                    placeholder="0-1200"
                    class="m-r-10 w-150px"
                    size="large"
                    :maxlength="6"
                    @touchstart="
                      onInputFocus($event, 'PostionData.uvMainPlatform0.x')
                    "
                  /><span class="text-gray">mm</span>
                </td>
              </tr>
              <tr>
                <td class="text-right">
                  Yè½´ï¼š
                </td>
                <td>
                  <a-input
                    v-model:value="PostionData.uvMainPlatform0.y"
                    placeholder="0-1200"
                    class="m-r-10 w-150px"
                    size="large"
                    :maxlength="6"
                    @touchstart="
                      onInputFocus($event, 'PostionData.uvMainPlatform0.y')
                    "
                  /><span class="text-gray">mm</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="w50% flex flex-col flex-1 pl-20">
          <div>ä¸»å‰¯é¡µï¼ˆå¹³å°2ï¼‰</div>
          <table>
            <tbody>
              <tr>
                <td class="text-right">
                  Xè½´ï¼š
                </td>
                <td>
                  <a-input
                    v-model:value="PostionData.uvMainPlatform1.x"
                    placeholder="0-1200"
                    class="m-r-10 w-150px"
                    size="large"
                    @touchstart="
                      onInputFocus($event, 'PostionData.uvMainPlatform1.x')
                    "
                  /><span class="text-gray">mm</span>
                </td>
              </tr>
              <tr>
                <td class="text-right">
                  Yè½´ï¼š
                </td>
                <td>
                  <a-input
                    v-model:value="PostionData.uvMainPlatform1.y"
                    placeholder="0-1200"
                    class="m-r-10 w-150px"
                    size="large"
                    @touchstart="
                      onInputFocus($event, 'PostionData.uvMainPlatform1.y')
                    "
                  /><span class="text-gray">mm</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
      <section class="position-box w-full flex p-t-0">
        <div class="w50% flex flex-col flex-1 pl-20">
          <div>åŠ æ³¨é¡µï¼ˆå¹³å°1ï¼‰</div>
          <table>
            <tbody>
              <tr>
                <td class="text-right">
                  Xè½´ï¼š
                </td>
                <td>
                  <a-input
                    v-model:value="PostionData.uvObsvPlatform0.x"
                    placeholder="0-1200"
                    class="m-r-10 w-150px"
                    size="large"
                    :maxlength="6"
                    @touchstart="
                      onInputFocus($event, 'PostionData.uvObsvPlatform0.x')
                    "
                  /><span class="text-gray">mm</span>
                </td>
              </tr>
              <tr>
                <td class="text-right">
                  Yè½´ï¼š
                </td>
                <td>
                  <a-input
                    v-model:value="PostionData.uvObsvPlatform0.y"
                    placeholder="0-1200"
                    class="m-r-10 w-150px"
                    size="large"
                    :maxlength="6"
                    @touchstart="
                      onInputFocus($event, 'PostionData.uvObsvPlatform0.y')
                    "
                  /><span class="text-gray">mm</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="w50% flex flex-col flex-1 pl-20">
          <div>åŠ æ³¨é¡µï¼ˆå¹³å°2ï¼‰</div>
          <table>
            <tbody>
              <tr>
                <td class="text-right">
                  Xè½´ï¼š
                </td>
                <td>
                  <a-input
                    v-model:value="PostionData.uvObsvPlatform1.x"
                    placeholder="0-1200"
                    class="m-r-10 w-150px"
                    size="large"
                    @touchstart="
                      onInputFocus($event, 'PostionData.uvObsvPlatform1.x')
                    "
                  /><span class="text-gray">mm</span>
                </td>
              </tr>
              <tr>
                <td class="text-right">
                  Yè½´ï¼š
                </td>
                <td>
                  <a-input
                    v-model:value="PostionData.uvObsvPlatform1.y"
                    placeholder="0-1200"
                    class="m-r-10 w-150px"
                    size="large"
                    @touchstart="
                      onInputFocus($event, 'PostionData.uvObsvPlatform1.y')
                    "
                  /><span class="text-gray">mm</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
      <div class="h50px w-full flex items-center justify-center">
        <a-button class="btn" type="primary" @click="BtnClick('æ‰“å°ä½ç½®é‡è¯»')">
          é‡è¯»
        </a-button>
        <a-button
          class="btn ml20"
          type="primary"
          @click="BtnClick('æ‰“å°ä½ç½®ä¿å­˜')"
        >
          ä¿å­˜
        </a-button>
      </div>
    </div>
    <div class="bg-[#fff]/[0.4] p-y-5px p-l-0.5em">
      <span>å–·å¢¨å®šä½åŸºå‡†</span>
      <!-- <a-popover>
        <template #content>
          <a-empty description="æš‚æ— æç¤ºå›¾ç‰‡" />
        </template>
        <QuestionCircleOutlined style="margin-left: 10px" />
      </a-popover> -->
    </div>
    <div>
      <section class="localtion-box w-full flex flex-col">
        <div class="flex flex-col flex-1 pl-20 pt20">
          <div class="w-full p-r-50 text-center color-blue font-bold">
            å¹³å°1
          </div>
          <div class="w-full flex flex-wrap">
            <table
              v-for="(item, index) in LocaltionData.platform0"
              :key="index"
            >
              <tbody>
                <tr>
                  {{
                    item.position
                  }}
                </tr>
                <tr>
                  <td class="text-right">
                    Xè½´ï¼š
                  </td>
                  <td>
                    <a-input
                      v-model:value="item.x"
                      placeholder="0-30000"
                      class="m-r-10 w-150px"
                      size="large"
                      :maxlength="5"
                      @touchstart="onInputFocus($event, `platform0.${index}.x`)"
                    /><span class="text-gray">0.001mm</span>
                  </td>
                </tr>
                <tr>
                  <td class="text-right">
                    Yè½´ï¼š
                  </td>
                  <td>
                    <a-input
                      v-model:value="item.y"
                      placeholder="0-30000"
                      class="m-r-10 w-150px"
                      :maxlength="5"
                      size="large"
                      @touchstart="onInputFocus($event, `platform0.${index}.y`)"
                    /><span class="text-gray">0.001mm</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
      <section class="localtion-box w-full flex flex-col">
        <div class="flex flex-col flex-1 pl-20 pt20">
          <div class="w-full p-r-50 text-center color-blue font-bold">
            å¹³å°2
          </div>
          <div class="w-full flex flex-wrap">
            <table
              v-for="(item, index) in LocaltionData.platform1"
              :key="index"
            >
              <tbody>
                <tr>
                  {{
                    item.position
                  }}
                </tr>
                <tr>
                  <td class="text-right">
                    Xè½´ï¼š
                  </td>
                  <td>
                    <a-input
                      v-model:value="item.x"
                      placeholder="0-1200"
                      :maxlength="5"
                      class="m-r-10 w-150px"
                      size="large"
                      @touchstart="onInputFocus($event, `platform1.${index}.x`)"
                    /><span class="text-gray">0.001mm</span>
                  </td>
                </tr>
                <tr>
                  <td class="text-right">
                    Yè½´ï¼š
                  </td>
                  <td>
                    <a-input
                      v-model:value="item.y"
                      placeholder="0-1200"
                      :maxlength="5"
                      class="m-r-10 w-150px"
                      size="large"
                      @touchstart="onInputFocus($event, `platform1.${index}.y`)"
                    /><span class="text-gray">0.001mm</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
      <div class="w-full flex items-center justify-center">
        <a-button class="btn" type="primary" @click="BtnClick('å®šä½åŸºå‡†é‡è¯»')">
          é‡è¯»
        </a-button>
        <a-button
          class="btn ml20"
          type="primary"
          @click="BtnClick('å®šä½åŸºå‡†ä¿å­˜')"
        >
          ä¿å­˜
        </a-button>
      </div>
    </div>
    <div class="bg-[#fff]/[0.4] p-y-5px p-l-0.5em">
      <span>è¿›æœ¬æ§½è®¾ç½®</span>
    </div>

    <section class="position-box w-full flex">
      <div class="flex flex-col flex-1 pl-20">
        <div class="mt10">
          è¿›æœ¬æ§½1
        </div>
        <div class="m-y-10 text-center">
          æ˜¯å¦å¯ç”¨ï¼š
          <a-switch
            v-model:checked="LoadSlotData.no1"
            @change="switchChange($event, 'LoadSlotData.no1')"
          />
        </div>
      </div>
      <div class="flex flex-col flex-1 pl-20">
        <div class="mt10">
          è¿›æœ¬æ§½2
        </div>
        <div class="m-y-10 text-center">
          æ˜¯å¦å¯ç”¨ï¼š
          <a-switch
            v-model:checked="LoadSlotData.no2"
            @change="switchChange($event, 'LoadSlotData.no2')"
          />
        </div>
      </div>
      <div class="flex flex-col flex-1 pl-20">
        <div class="mt10">
          è¿›æœ¬æ§½3
        </div>
        <div class="m-y-10 text-center">
          æ˜¯å¦å¯ç”¨ï¼š
          <a-switch
            v-model:checked="LoadSlotData.no3"
            @change="switchChange($event, 'LoadSlotData.no3')"
          />
        </div>
      </div>
      <div class="flex flex-col flex-1 pl-20">
        <div class="mt10">
          è¿›æœ¬æ§½4
        </div>
        <div class="m-y-10 text-center">
          æ˜¯å¦å¯ç”¨ï¼š
          <a-switch
            v-model:checked="LoadSlotData.no4"
            @change="switchChange($event, 'LoadSlotData.no4')"
          />
        </div>
      </div>
    </section>
    <div class="bg-[#fff]/[0.4] p-y-5px p-l-0.5em">
      <span>æ”¶æœ¬æ§½è®¾ç½®</span>
    </div>

    <section class="position-box w-full flex">
      <div class="flex flex-col flex-1 pl-20">
        <div class="mt10">
          æ”¶æœ¬æ§½1
        </div>
        <div class="m-y-10 text-center">
          æ˜¯å¦å¯ç”¨ï¼š
          <a-switch
            v-model:checked="CollectionSlot.no1"
            @change="switchChange($event, 'CollectionSlot.no1')"
          />
        </div>
      </div>
      <div class="flex flex-col flex-1 pl-20">
        <div class="mt10">
          æ”¶æœ¬æ§½2
        </div>
        <div class="m-y-10 text-center">
          æ˜¯å¦å¯ç”¨ï¼š
          <a-switch
            v-model:checked="CollectionSlot.no2"
            @change="switchChange($event, 'CollectionSlot.no2')"
          />
        </div>
      </div>
      <div class="flex flex-col flex-1 pl-20">
        <div class="mt10">
          æ”¶æœ¬æ§½3
        </div>
        <div class="m-y-10 text-center">
          æ˜¯å¦å¯ç”¨ï¼š
          <a-switch
            v-model:checked="CollectionSlot.no3"
            @change="switchChange($event, 'CollectionSlot.no3')"
          />
        </div>
      </div>
      <div class="flex flex-col flex-1 pl-20">
        <div class="mt10">
          æ”¶æœ¬æ§½4
        </div>
        <div class="m-y-10 text-center">
          æ˜¯å¦å¯ç”¨ï¼š
          <a-switch
            v-model:checked="CollectionSlot.no4"
            @change="switchChange($event, 'CollectionSlot.no4')"
          />
        </div>
      </div>
      <div class="flex flex-col flex-1 pl-20">
        <div class="mt10">
          æ”¶æœ¬æ§½5
        </div>
        <div class="m-y-10 text-center">
          æ˜¯å¦å¯ç”¨ï¼š
          <a-switch
            v-model:checked="CollectionSlot.no5"
            @change="switchChange($event, 'CollectionSlot.no5')"
          />
        </div>
      </div>
    </section>
    <div class="bg-[#fff]/[0.4] p-y-5px p-l-0.5em">
      <span>æ¼”ç¤ºæ¨¡å¼</span>
    </div>
    <section class="p-l-2em p-t-1em">
      <a-button class="btn" type="primary" @click="$goto('AddTask')">
        æ·»åŠ ä»»åŠ¡
      </a-button>
    </section>
    <div class="mt1em bg-[#fff]/[0.4] p-y-5px p-l-0.5em">
      <span>å¯†ç è®¾ç½®</span>
    </div>
    <section class="p-b-1em p-l-2em p-t-1em">
      <a-button class="btn" type="primary" @click="setSuccessOpen(true)">
        å¯†ç è®¾ç½®
      </a-button>
    </section>
    <SuceessModal
      :open="successOpen"
      :handle-ok="() => setSuccessOpen(false)"
      :handle-cancel="() => setSuccessOpen(false)"
      title="è®¾ç½®å¯†ç "
    />

    <contextHolder />
  </div>
</template>

<script lang="ts" setup>
import { settingMoule } from '@/apis/proApi';
import SimpleKeyboard from '@/components/base/simpleKeyboard.vue';
import { contextHolder } from '@/components/base/useNotification';
import { useAppStore } from '@/store/index';
import { App } from 'ant-design-vue';
import SuceessModal from './sort/setPwModal.vue';

const props = defineProps({
  currentModel: String,
});
const successOpen = ref<boolean>(false);
function setSuccessOpen(value: boolean) {
  successOpen.value = value;
}
const { notification } = App.useApp();
const layout = ref('num');
const PostionData = ref({
  uvMainPlatform0: {
    x: 0,
    y: 0,
  },
  uvMainPlatform1: {
    x: 0,
    y: 0,
  },
  uvObsvPlatform0: {
    x: 0,
    y: 0,
  },
  uvObsvPlatform1: {
    x: 0,
    y: 0,
  },
});
const LocaltionData = ref({
  platform0: [
    {
      position: 'M2-UV-1',
      x: 0,
      y: 0,
    },
    {
      position: 'M2-UV-2',
      x: 0,
      y: 0,
    },
    {
      position: 'M2-UV-3',
      x: 0,
      y: 0,
    },
    {
      position: 'M2-UV-4',
      x: 0,
      y: 0,
    },
  ],
  platform1: [
    {
      position: 'M2-UV-1',
      x: 0,
      y: 0,
    },
    {
      position: 'M2-UV-2',
      x: 0,
      y: 0,
    },
    {
      position: 'M2-UV-3',
      x: 0,
      y: 0,
    },
    {
      position: 'M2-UV-4',
      x: 0,
      y: 0,
    },
  ],
});
const LoadSlotData = ref({
  no1: 1,
  no2: 1,
  no3: 1,
  no4: 1,
});
const CollectionSlot = ref({
  no1: 1,
  no2: 1,
  no3: 1,
  no4: 1,
});
async function getData() {
  try {
    useAppStore().setSpinning(true);
    const postionData = await settingMoule.getUvPlatformConfig();
    const localtionData = await settingMoule.getUvLocationg();
    const loadSlotData = await settingMoule.getLoadSlot();
    const collectionSlot = await settingMoule.getCollectionSlot();
    if (
      postionData.respData
      && localtionData.respData
      && loadSlotData.respData
      && collectionSlot.respData
    ) {
      PostionData.value = postionData.respData;
      LocaltionData.value = localtionData.respData;
      for (const key in loadSlotData.respData) {
        LoadSlotData.value[key] = loadSlotData.respData[key] === 1;
      }
      for (const key in collectionSlot.respData) {
        CollectionSlot.value[key] = collectionSlot.respData[key] === 1;
      }
    }
    else {
      notification.error({
        message: `é”™è¯¯`,
        description: 'è¯»å–è®¾ç½®é¡µé¢å¤±è´¥',
        class: 'notification-custom-class',
        placement: 'bottomRight',
      });
    }
  }
  catch (error) {
    notification.error({
      message: `é”™è¯¯`,
      class: 'notification-custom-class',
      description: error,
      placement: 'bottomRight',
    });
  }
  finally {
    useAppStore().setSpinning(false);
  }
}

// è·å–åˆ†ç±»åç§°çš„å‡½æ•°
function getCategoryName(category) {
  switch (category) {
    case 'uvMainPlatform0':
      return 'ä¸»å‰¯é¡µï¼ˆå¹³å°1ï¼‰';
    case 'uvMainPlatform1':
      return 'ä¸»å‰¯é¡µï¼ˆå¹³å°2ï¼‰';
    case 'uvObsvPlatform0':
      return 'åŠ æ³¨é¡µï¼ˆå¹³å°1ï¼‰';
    case 'uvObsvPlatform1':
      return 'åŠ æ³¨é¡µï¼ˆå¹³å°2ï¼‰';
    default:
      return category;
  }
}
async function switchChange(e, item) {
  const isLoadSlot = splitStringByDot(item).firstPart === 'LoadSlotData';
  const targetData = isLoadSlot ? LoadSlotData.value : CollectionSlot.value;
  const apiMethod = isLoadSlot
    ? settingMoule.setLoadSlot
    : settingMoule.setCollectionSlot;

  const slotData = Object.fromEntries(
    Object.keys(targetData).map(key => [
      key,
      Number(targetData[key] === true),
    ]),
  );

  try {
    useAppStore().setSpinning(true);
    await apiMethod(slotData);
  }
  catch (error) {
    notification.error({
      message: 'é”™è¯¯',
      description: error,
      class: 'notification-custom-class',
      placement: 'bottomRight',
    });
    targetData[splitStringByDot(item).secondPart]
      = !targetData[splitStringByDot(item).secondPart];
  }
  finally {
    useAppStore().setSpinning(false);
  }
}
// æŒ‰é’®äº‹ä»¶
async function BtnClick(key: string) {
  useAppStore().setSpinning(true);
  switch (key) {
    case 'æ‰“å°ä½ç½®é‡è¯»':
      try {
        const data = await settingMoule.getUvPlatformConfig();
        if (data.respData) {
          PostionData.value = data.respData;
        }
      }
      catch (error) {
        notification.error({
          message: `é”™è¯¯`,
          description: error,
          class: 'notification-custom-class',
          placement: 'bottomRight',
        });
      }
      finally {
        useAppStore().setSpinning(false);
      }

      break;
    case 'æ‰“å°ä½ç½®ä¿å­˜':
      try {
        Object.keys(PostionData.value).forEach((key) => {
          const xStr = PostionData.value[key].x;
          const yStr = PostionData.value[key].y;
          // æ ¡éªŒ x
          const xNum = Number.parseFloat(xStr);
          const yNum = Number.parseFloat(yStr);

          // æ ¡éªŒ x æ˜¯å¦ä¸ºæ•°å­—ä¸”åœ¨ 0 åˆ° 1200 çš„èŒƒå›´å†…
          if (Number.isNaN(xNum) || xNum < 0 || xNum > 1200) {
            throw new Error(
              `å–·å¢¨æ‰“å°ä½ç½®è°ƒæ•´:${getCategoryName(key)}Xè½´èŒƒå›´æ˜¯ï¼ˆ0-1200ï¼‰`,
            );
          }

          // æ ¡éªŒ y æ˜¯å¦ä¸ºæ•°å­—ä¸”åœ¨ 0 åˆ° 1200 çš„èŒƒå›´å†…
          if (Number.isNaN(yNum) || yNum < 0 || yNum > 1200) {
            throw new Error(
              `å–·å¢¨æ‰“å°ä½ç½®è°ƒæ•´:'+${getCategoryName(key)}+'Yè½´èŒƒå›´æ˜¯ï¼ˆ0-1200ï¼‰`,
            );
          }

          PostionData.value[key].x = Number.parseFloat(xNum.toFixed(2));
          PostionData.value[key].y = Number.parseFloat(yNum.toFixed(2));
        });
        await settingMoule.setUvPlatformConfig(PostionData.value);
        await BtnClick('æ‰“å°ä½ç½®é‡è¯»');
        notification.success({
          message: `æˆåŠŸ`,
          description: 'ä¿å­˜å–·å¢¨å¹³å°é…ç½®æˆåŠŸ',
          class: 'notification-custom-class',
          placement: 'bottomRight',
        });
      }
      catch (error) {
        notification.error({
          message: `é”™è¯¯`,
          description: error,
          class: 'notification-custom-class',
          placement: 'bottomRight',
        });
      }
      finally {
        useAppStore().setSpinning(false);
      }

      break;
    case 'å®šä½åŸºå‡†é‡è¯»':
      try {
        const data = await settingMoule.getUvLocationg();
        if (data.respData) {
          LocaltionData.value = data.respData;
        }
      }
      catch (error) {
        notification.error({
          message: `é”™è¯¯`,
          description: error,
          class: 'notification-custom-class',
          placement: 'bottomRight',
        });
      }
      finally {
        useAppStore().setSpinning(false);
      }
      break;
    case 'å®šä½åŸºå‡†ä¿å­˜':
      try {
        Object.keys(LocaltionData.value).forEach((platformKey) => {
          LocaltionData.value[platformKey].forEach((item) => {
            const xStr = item.x;
            const yStr = item.y;

            // æ ¡éªŒ x
            const xNum = Number.parseFloat(xStr);
            if (Number.isNaN(xNum) || xNum < 0 || xNum > 30000) {
              throw new Error(
                `å–·å¢¨å®šä½åŸºå‡†:${item.position} Xè½´èŒƒå›´æ˜¯ï¼ˆ0-30000ï¼‰`,
              );
            }

            // æ ¡éªŒ y
            const yNum = Number.parseFloat(yStr);
            if (Number.isNaN(yNum) || yNum < 0 || yNum > 30000) {
              throw new Error(
                `å–·å¢¨å®šä½åŸºå‡†:${item.position} Yè½´èŒƒå›´æ˜¯ï¼ˆ0-30000ï¼‰`,
              );
            }

            // ä¿ç•™ä¸¤ä½å°æ•°
            item.x = Number.parseFloat(xNum.toFixed(2));
            item.y = Number.parseFloat(yNum.toFixed(2));
          });
        });

        await settingMoule.setUvLocationg(LocaltionData.value);
        await BtnClick('å®šä½åŸºå‡†é‡è¯»');
        notification.success({
          message: `æˆåŠŸ`,
          description: 'ä¿å­˜å–·å¢¨å®šä½åŸºå‡†æˆåŠŸ',
          class: 'notification-custom-class',
          placement: 'bottomRight',
        });
      }
      catch (error) {
        notification.error({
          message: `é”™è¯¯`,
          description: error,
          class: 'notification-custom-class',
          placement: 'bottomRight',
        });
      }
      finally {
        useAppStore().setSpinning(false);
      }

      break;
  }
}

// function validateInput(event, item) {
//   // è·å–è¾“å…¥æ¡†çš„å€¼
//   let value = event.target.value;
//   if (layout.value == 'floatNum') {
//     value = value.replace(/[^0-9.]/g, '');

//     // åˆ†å‰²å­—ç¬¦ä¸²ä¸ºä¸¤éƒ¨åˆ†ï¼šç¬¬ä¸€ä¸ªå°æ•°ç‚¹ä¹‹å‰çš„éƒ¨åˆ†å’Œä¹‹åçš„éƒ¨åˆ†
//     const parts = value.split('.');
//     if (parts.length > 2) {
//       // å¦‚æœæœ‰å¤šä¸ªå°æ•°ç‚¹ï¼Œåªä¿ç•™ç¬¬ä¸€ä¸ªå°æ•°ç‚¹åŠå…¶ä¹‹åçš„å†…å®¹
//       value = `${parts[0]}.${parts.slice(1).join('')}`;
//     } else if (parts.length === 2) {
//       // å¦‚æœåªæœ‰ä¸€ä¸ªå°æ•°ç‚¹ï¼Œä¿æŒåŸæ ·
//       value = parts.join('.');
//     } else {
//       // å¦‚æœæ²¡æœ‰å°æ•°ç‚¹ï¼Œä¿æŒåŸæ ·
//       value = parts[0];
//     }

//     value = value.replace(/^\./, '0.'); // å¦‚æœä»¥å°æ•°ç‚¹å¼€å¤´ï¼Œè‡ªåŠ¨è¡¥0
//     // æ­¥éª¤3ï¼šæ¸…é™¤å‰å¯¼é›¶ï¼ˆä½†ä¿ç•™å°æ•°éƒ¨åˆ†ï¼‰
//     value = value.replace(/^0+(\d)/, '$1'); // ç§»é™¤å‰å¯¼é›¶ï¼Œä½†ä¿ç•™å°æ•°éƒ¨åˆ†
//     // æ­¥éª¤4ï¼šä¿ç•™ä¸¤ä½å°æ•°
//     value = value.replace(/(\.\d{2})\d+/, '$1'); // ä¿ç•™ä¸¤ä½å°æ•°
//     if (value > 1200) {
//       value = 1200;
//     }
//     if (value === '') {
//       value = 0;
//     }
//   } else {
//   }

//   event.target.value = value;
//   if (splitStringByDot(item).firstPart == 'PostionData') {
//     PostionData.value[splitStringByDot(item).secondPart][
//       splitStringByDot(item).thirdPart
//     ] = value;
//   }
// }

function splitStringByDot(str) {
  // ä½¿ç”¨ split æ–¹æ³•æŒ‰ '.' åˆ†å‰²å­—ç¬¦ä¸²
  const parts = str.split('.');

  // è·å–ç¬¬ä¸€ä¸ªç‚¹ä¹‹å‰çš„å­—ç¬¦ä¸²
  const firstPart = parts[0] || ''; // å¦‚æœæ²¡æœ‰ç‚¹ï¼Œæ•´ä¸ªå­—ç¬¦ä¸²ä½œä¸ºç¬¬ä¸€éƒ¨åˆ†

  // è·å–ç¬¬ä¸€ä¸ªç‚¹å’Œç¬¬äºŒä¸ªç‚¹ä¹‹é—´çš„å­—ç¬¦ä¸²
  const secondPart = parts.length > 1 ? parts[1] || '' : ''; // å¦‚æœæ²¡æœ‰ç¬¬äºŒä¸ªç‚¹ï¼Œç¬¬äºŒéƒ¨åˆ†ä¸ºç©º

  // è·å–ç¬¬äºŒä¸ªç‚¹ä¹‹åçš„å­—ç¬¦ä¸²
  const thirdPart = parts.length > 2 ? parts.slice(2).join('.') : ''; // å¦‚æœæ²¡æœ‰ç¬¬äºŒä¸ªç‚¹ï¼Œç¬¬ä¸‰éƒ¨åˆ†ä¸ºç©º

  return { firstPart, secondPart, thirdPart };
}

const changeIpt = ref([0, 0, 0]);
const showKeyboard = ref(false);
const simpleKeyboard = ref(null);
const cursorPosition = ref(null);
function onInputFocus(event, item) {
  showKeyboard.value = false;
  if (splitStringByDot(item).firstPart === 'PostionData') {
    layout.value = 'floatNum';
  }
  else {
    layout.value = 'num';
  }
  showKeyboard.value = true;
  changeIpt.value = item;
  cursorPosition.value = event;
}
// ç»™è¾“å…¥æ¡†èµ‹å€¼;
function onChangeKeyboard(input, keyboard) {
  const caretPosition = keyboard.caretPosition;
  if (caretPosition !== null)
    setInputCaretPosition(cursorPosition.value.target, caretPosition);
  cursorPosition.value.target.value = input;
  if (splitStringByDot(changeIpt.value).firstPart === 'PostionData') {
    PostionData.value[splitStringByDot(changeIpt.value).secondPart][
      splitStringByDot(changeIpt.value).thirdPart
    ] = input;
  }
  else {
    LocaltionData.value[splitStringByDot(changeIpt.value).firstPart][
      splitStringByDot(changeIpt.value).secondPart
    ][splitStringByDot(changeIpt.value).thirdPart] = input;
  }
}
function setInputCaretPosition(elem, pos) {
  setTimeout(() => {
    if (elem.setSelectionRange) {
      elem.focus();
      elem.setSelectionRange(pos, pos);
    }
  });
}
function closekeyboard() {
  showKeyboard.value = false;
}
watch(
  () => props.currentModel,
  () => {
    console.log('ğŸš€ ~  props.currentModel:', props.currentModel);
    showKeyboard.value = false;
    getData();
  },
  { deep: true, immediate: true },
);
onDeactivated(() => {
  showKeyboard.value = false;
});
</script>

<style scoped lang="scss">
.btn {
  border-radius: 6px;
  opacity: 1;
  background: linear-gradient(209deg, #90ecff 2%, #006af5 69%);
  box-sizing: border-box;
  border: 2px solid #89f7ff;
  padding: 6px 20px;
  color: white;
  height: 40px;
}
.position-box {
  table {
    border-collapse: separate;
    border-spacing: 10px;
  }
  td,
  th {
    padding: 5px;
  }
}
.localtion-box {
  table {
    border-collapse: separate;
    border-spacing: 10px;
    width: 50%;
  }
  td,
  th {
    padding: 5px;
  }
}
// .ant-switch-inner {
//   border: 2px solid #87f6ff;
// }
// .ant-switch-checked {
//   background: #6ad356 !important;
//   .ant-switch-inner {
//     border: 0;
//   }
// }
</style>
